import requests
import re

# URL del sito web
url = "http://infinite.challs.olicyber.it/"
# Creazione della sessione
session = requests.session()

# Funzione per risolvere una sfida di matematica
def solve_math_challenge(challenge):
    # Estrai i numeri dall'enunciato della sfida
    numbers = re.findall(r'\d+', challenge)
    # Calcola la somma dei numeri e restituisci il risultato come stringa
    return str(sum(map(int, numbers)))

# Funzione per risolvere una sfida di arte
def solve_art_challenge(challenge):
    # Estrai il colore del pulsante dall'enunciato della sfida
    color = re.findall(r'colore ([a-zA-Z]+)\?', challenge)[0]
    if color == 'Blu':
        return 'Blu'
    elif color == 'Verde':
        return 'Verde'
    elif color == 'Rosso':
        return 'Rosso'
    elif color == 'Giallo':
        return 'Giallo'
    else:
        return 'unknown color'

# Funzione per risolvere una sfida di grammatica
def solve_grammar_challenge(challenge):
    # cerca la parola e la lettera da cercare nella sfida
    match = re.findall(r'Quante "(.)" ci sono nella parola "(.+)"\?', challenge)
    # verifica se il match è stato trovato
    if not match:
        match = 0
    # estrai la parola e la lettera dalla corrispondenza
    try:
        letter, word = match[0]
    except:
        print(match)
    # conta quante volte appare la lettera nella parola e restituisci il risultato come stringa
    return str(word.lower().count(letter.lower()))

# Esegui il ciclo per risolvere tutte le sfide
for i in range(1,503):
    # Richiedi la pagina web
    response1 = session.get(url)
    # Estrai il testo della pagina
    page_text = response1.text
    # Trova l'enunciato della sfida
    challenge = re.findall(r'<p>(.+)</p>', page_text)[0]
    # Trova il tipo di sfida
    challenge_type = re.findall(r'<h2>(.+)</h2>', page_text)[0]
    # Risolvi la sfida in base al tipo
    if challenge_type == "MATH TEST":
        solution = solve_math_challenge(challenge)
    elif challenge_type == "ART TEST":
        solution = solve_art_challenge(challenge)
    elif challenge_type == "GRAMMAR TEST":
        solution = solve_grammar_challenge(challenge)
    else:
        # Tipo di sfida non riconosciuto, esci dal ciclo
        break
    # Invia la soluzione
    response = session.post(url, data={'answer': solution})
    # Estrai il testo della pagina di risposta
    response_text = response.text
    # Controlla se la risposta è corretta
    if "WRONG!" in response_text:
        print(f"Sfida {challenge_type} non risolta correttamente.")
        print(response1.text)
        print(solution)
        print(challenge)
        # Esci dal ciclo
        break
    elif "flag" in response_text:
        print(response_text)
        cookie_secret = response.cookies.get('secret')
        print(f"Cookie 'secret': {cookie_secret}")
        break
    else:
        print(f"{i}Sfida {challenge_type} risolta correttamente!")
        if i > 497:
            print(response1.text)
            print(response_text)
            cookie_secret = response.cookies.get('secret')
            print(f"Cookie 'secret': {cookie_secret}")
        
