# Importiamo la libreria scapy
from scapy.all import *

# Carichiamo il file pcapng
packets = rdpcap("capture.pcapng")

# Variabile booleana per tenere traccia di "local"
found_local = False

zip = []
# Loop su tutti i pacchetti per trovare solo quelli DNS
for packet in packets:
    # Verifica se il pacchetto è un pacchetto DNS
    if packet.haslayer(DNS) and packet.getlayer(DNS).qr == 0:
        # Ottieni il campo Queries
        query = packet.getlayer(DNS).qd.qname
        # Rimuovi ".attacker.eve." dalla stringa
        query = query.replace(".attacker.eve.".encode(), "".encode())
        # Dividi la stringa su un punto e prendi la seconda parte
        query = query.split(".".encode())[1]
        # Verifica se "local" è presente nella stringa
        if "local".encode() in query:
            print("---ZIP---")
        else:
            zip.append(query)
        
output = "".encode().join(zip)
with open("output.txt", "wb") as f:
    f.write(output)
